# Week14 프로젝트 기술 문서

## 1. 프로젝트 개요

이 프로젝트는 Lua 스크립트 언어로 작성된 3D 러닝 게임입니다. 플레이어는 게임패드를 사용하여 캐릭터를 조작하고, 총을 쏘아 몬스터를 처치하며 앞으로 달려나갑니다.

---

## 2. 게임 구조 (w14_*.lua 파일들)

### 2.1 핵심 구성 요소

게임은 다음과 같은 주요 매니저들로 구성됩니다:

| 파일명 | 역할 |
|--------|------|
| `w14_GameMain.lua` | 게임 전체 흐름 제어 (시작, 진행, 종료) |
| `w14_Player.lua` | 플레이어 이동, 사격, 상태 관리 |
| `w14_GeneralObjectManager.lua` | 장애물, 아이템 등 일반 오브젝트 관리 |
| `w14_MonsterManager.lua` | 몬스터 생성 및 관리 |

### 2.2 오브젝트 풀 시스템

게임에서는 **오브젝트 풀(Object Pool)** 패턴을 사용합니다. 이는 게임 오브젝트를 미리 생성해두고 재사용하는 방식입니다.

**작동 원리:**
1. 게임 시작 시 일정 수의 오브젝트를 미리 생성하여 "대기 큐"에 보관
2. 오브젝트가 필요하면 대기 큐에서 꺼내 "활성 큐"로 이동 (spawn)
3. 오브젝트가 화면 밖으로 나가면 다시 대기 큐로 반환 (despawn)

활성 큐는 **우선순위 큐(Priority Queue)** 자료구조를 사용하여, X좌표가 가장 작은(플레이어 뒤쪽에 있는) 오브젝트가 먼저 회수되도록 최적화되어 있습니다.

```lua
-- 오브젝트 풀 초기화 예시
Pool:initialize(prefab_path, name, pool_size, standby_location)
```

### 2.3 게임 루프

매 프레임마다 `Tick()` 함수가 호출되어 다음을 처리합니다:
- 플레이어 입력 처리
- 몬스터/오브젝트 spawn/despawn 조건 확인
- 충돌 및 게임 로직 처리

---

## 3. 게임패드 입력 처리

### 3.1 입력 시스템 구조

`w14_PlayerInput.lua`에서 게임패드 입력을 처리합니다. 엔진이 제공하는 `InputManager` API를 통해 컨트롤러 상태를 읽어옵니다.

### 3.2 지원하는 입력 종류

| 입력 장치 | 용도 | 값의 범위 |
|-----------|------|-----------|
| 왼쪽 스틱 | 캐릭터 이동 | -1.0 ~ 1.0 (X, Y축) |
| 오른쪽 스틱 | 카메라/조준 | -1.0 ~ 1.0 (X, Y축) |
| 오른쪽 트리거 | 사격 | 0.0 ~ 1.0 |
| 왼쪽 트리거 | 보조 기능 | 0.0 ~ 1.0 |
| 버튼 (A, B 등) | 점프, 재장전 등 | true/false |

### 3.3 데드존(Deadzone) 처리

스틱 입력에는 **데드존**이 적용됩니다. 스틱을 살짝 건드려도 캐릭터가 움직이지 않도록, 일정 임계값 이하의 입력은 무시합니다.

```lua
-- 데드존 적용 로직
if math.abs(input_value) < deadzone then
    input_value = 0
end
```

---

## 4. PhysX Raycast (광선 투사)

### 4.1 Raycast란?

**Raycast**는 3D 공간에서 보이지 않는 광선을 쏘아, 그 광선이 어떤 물체와 충돌하는지 확인하는 기술입니다. 이 프로젝트에서는 총알이 명중했는지 판정하는 데 사용됩니다.

### 4.2 작동 방식

플레이어가 사격 버튼을 누르면:
1. 카메라 위치에서 카메라가 바라보는 방향으로 광선 발사
2. 광선이 충돌한 물체와 충돌 지점 정보 반환
3. 충돌한 물체가 몬스터면 데미지 처리

```lua
-- Raycast 호출 (w14_Player.lua)
local HitResult = Physics.Raycast(CamPos + CamDir, CamDir, MaxDist)
```

### 4.3 반환 정보

Raycast가 물체와 충돌하면 다음 정보를 반환합니다:
- `HitResult.Actor`: 충돌한 게임 오브젝트
- `HitResult.Location`: 충돌 지점의 3D 좌표

이 정보를 활용하여 충돌 지점에 파티클 효과를 생성하거나, 맞은 대상에게 데미지를 적용합니다.

---

## 5. 파일 구조 요약

```
w14_GameMain.lua          -- 게임 메인 로직
w14_Player.lua            -- 플레이어 제어
w14_PlayerInput.lua       -- 게임패드 입력 처리
w14_ObjectPool.lua        -- 오브젝트 풀 시스템
w14_Queue.lua             -- 큐 자료구조
w14_PriorityQueue.lua     -- 우선순위 큐 자료구조
w14_GeneralObjectManager.lua  -- 일반 오브젝트 관리
w14_MonsterManager.lua    -- 몬스터 관리
w14_MapConfig.lua         -- 맵 설정값
```

---

## 6. 기술 스택

- **스크립트 언어**: Lua
- **물리 엔진**: PhysX (NVIDIA)
- **게임 엔진**: Mundi (커스텀 엔진)
